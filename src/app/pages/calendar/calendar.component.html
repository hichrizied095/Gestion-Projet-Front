<div class="calendar-page py-5">
  <div class="container-fluid px-4">
    <!-- Header Section -->
    <div class="header-section mb-4" data-aos="fade-down">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
          <h2 class="page-title mb-1">Calendrier des Ã‰vÃ©nements</h2>
          <p class="text-secondary">Visualisez toutes vos tÃ¢ches et rÃ©unions en un coup d'Å“il</p>
        </div>
        <button class="btn btn-primary-gradient shadow-sm" (click)="loadCalendarData()">
          <i class="fas fa-sync-alt me-2"></i>Actualiser
        </button>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row g-3 mb-4" data-aos="fade-up">
      <div class="col-lg-3 col-md-6">
        <div class="stat-card card border-0 shadow-sm rounded-4 overflow-hidden">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <p class="text-secondary mb-1 small">Total TÃ¢ches</p>
                <h3 class="mb-0 fw-bold">{{ stats.totalTasks }}</h3>
              </div>
              <div class="stat-icon bg-primary-soft">
                <i class="fas fa-tasks text-primary"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6">
        <div class="stat-card card border-0 shadow-sm rounded-4 overflow-hidden">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <p class="text-secondary mb-1 small">TerminÃ©es</p>
                <h3 class="mb-0 fw-bold text-success">{{ stats.completedTasks }}</h3>
              </div>
              <div class="stat-icon bg-success-soft">
                <i class="fas fa-check-circle text-success"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6">
        <div class="stat-card card border-0 shadow-sm rounded-4 overflow-hidden">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <p class="text-secondary mb-1 small">En Retard</p>
                <h3 class="mb-0 fw-bold text-danger">{{ stats.overdueTasks }}</h3>
              </div>
              <div class="stat-icon bg-danger-soft">
                <i class="fas fa-exclamation-triangle text-danger"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6">
        <div class="stat-card card border-0 shadow-sm rounded-4 overflow-hidden">
          <div class="card-body p-4">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <p class="text-secondary mb-1 small">RÃ©unions Ã  venir</p>
                <h3 class="mb-0 fw-bold text-purple">{{ stats.upcomingMeetings }}</h3>
              </div>
              <div class="stat-icon bg-purple-soft">
                <i class="fas fa-calendar-alt text-purple"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Legend -->
    <div class="legend-section mb-4 p-3 bg-white rounded-4 shadow-sm" data-aos="fade-up">
      <div class="d-flex flex-wrap gap-3 align-items-center">
        <span class="fw-bold text-secondary me-2">LÃ©gende :</span>
        <div class="legend-item">
          <span class="legend-dot bg-primary"></span>
          <span class="small">ðŸ”µ PlanifiÃ©e</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot bg-warning-custom"></span>
          <span class="small">ðŸŸ  En cours</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot bg-danger"></span>
          <span class="small">ðŸ”´ En retard</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot bg-success"></span>
          <span class="small">ðŸŸ¢ TerminÃ©e</span>
        </div>
        <div class="legend-item">
          <span class="legend-dot bg-purple"></span>
          <span class="small">ðŸŽ¯ RÃ©union</span>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="text-center py-5">
      <div class="spinner-border text-primary mb-3" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
      <p class="text-secondary">Chargement du calendrier...</p>
    </div>

    <!-- Calendar -->
    <div *ngIf="!isLoading" class="calendar-container card border-0 shadow-sm rounded-4 overflow-hidden"
      data-aos="zoom-in">
      <div class="card-body p-4">
        <full-calendar [options]="calendarOptions"></full-calendar>
      </div>
    </div>

    <!-- âœ… NOUVEAU: Panneau de dÃ©tails du jour -->
    <div *ngIf="showDayDetails" id="day-details-section" class="day-details-panel mt-4 card border-0 shadow-sm rounded-4 overflow-hidden" data-aos="fade-up">
      <div class="card-header bg-gradient-primary text-white p-3">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h5 class="mb-0">
              <i class="fas fa-calendar-day me-2"></i>
              {{ selectedDateStr }}
            </h5>
            <small class="opacity-75">{{ dayEvents.length }} Ã©vÃ©nement(s)</small>
          </div>
          <button class="btn btn-light btn-sm" (click)="closeDayDetails()">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <div class="card-body p-4">
        <!-- Aucun Ã©vÃ©nement -->
        <div *ngIf="dayEvents.length === 0" class="text-center text-muted py-5">
          <i class="fas fa-calendar-times fa-3x mb-3 opacity-50"></i>
          <p class="mb-0">Aucun Ã©vÃ©nement prÃ©vu ce jour</p>
        </div>

        <!-- Liste des Ã©vÃ©nements -->
        <div *ngIf="dayEvents.length > 0" class="events-list">
          <div *ngFor="let event of dayEvents; let i = index" class="event-item mb-3 p-3 rounded-3 border-start border-4"
            [style.border-color]="event.backgroundColor">
            
            <!-- En-tÃªte de l'Ã©vÃ©nement -->
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div class="flex-grow-1">
                <h6 class="mb-1 fw-bold">
                  <span *ngIf="event.type === 'task'">ðŸ“‹</span>
                  <span *ngIf="event.type === 'meeting'">ðŸŽ¯</span>
                  {{ event.title }}
                </h6>
                <span class="badge me-2" [style.background-color]="event.backgroundColor">
                  {{ event.type === 'task' ? 'TÃ¢che' : 'RÃ©union' }}
                </span>
                <span *ngIf="event.status" class="badge bg-light text-dark">
                  {{ event.status }}
                </span>
              </div>
              <div *ngIf="event.startTime" class="text-end">
                <small class="text-primary fw-bold">
                  <i class="fas fa-clock me-1"></i>
                  {{ event.startTime }}
                  <span *ngIf="event.endTime"> - {{ event.endTime }}</span>
                </small>
              </div>
            </div>

            <!-- DÃ©tails de la tÃ¢che -->
            <div *ngIf="event.type === 'task'" class="event-details mt-2">
              <div class="row g-2">
                <div class="col-md-6">
                  <small class="text-muted">
                    <i class="fas fa-folder me-1"></i>
                    <strong>Projet:</strong> {{ event.project }}
                  </small>
                </div>
                <div class="col-md-6">
                  <small class="text-muted">
                    <i class="fas fa-user me-1"></i>
                    <strong>AssignÃ© Ã :</strong> {{ event.assignedUser }}
                  </small>
                </div>
              </div>
              <div *ngIf="event.description" class="mt-2">
                <small class="text-muted">
                  <i class="fas fa-align-left me-1"></i>
                  <strong>Description:</strong>
                </small>
                <p class="mb-0 mt-1 text-secondary small">{{ event.description }}</p>
              </div>
            </div>

            <!-- DÃ©tails de la rÃ©union -->
            <div *ngIf="event.type === 'meeting'" class="event-details mt-2">
              <div class="row g-2">
                <div class="col-md-6">
                  <small class="text-muted">
                    <i class="fas fa-folder me-1"></i>
                    <strong>Projet:</strong> {{ event.project }}
                  </small>
                </div>
                <div class="col-md-6">
                  <small class="text-muted">
                    <i class="fas fa-users me-1"></i>
                    <strong>Participants:</strong> {{ event.attendees }}
                  </small>
                </div>
              </div>
              <div *ngIf="event.duration" class="mt-2">
                <small class="text-muted">
                  <i class="fas fa-hourglass-half me-1"></i>
                  <strong>DurÃ©e:</strong> {{ event.duration }} minutes
                </small>
              </div>
            </div>

            <!-- SÃ©parateur entre Ã©vÃ©nements -->
            <hr *ngIf="i < dayEvents.length - 1" class="my-3 opacity-25">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>