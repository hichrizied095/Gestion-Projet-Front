<div class="dashboard-wrapper">

  <!-- ========================================
       BACKGROUND DECORATIONS
       ======================================== -->
  <div class="background-decoration">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>

  <div class="dashboard-content">

    <!-- ========================================
         HEADER SIMPLIFIÉ
         ======================================== -->
    <header class="dashboard-header-modern">
      <div class="header-glass">
        <div class="header-left">
          <div class="header-icon-wrapper">
            <i class="bi bi-speedometer2"></i>
          </div>
          <div class="header-text">
            <h1>Dashboard Admin</h1>
            <p>
              <i class="bi bi-clock-fill"></i>
              {{ lastUpdated | date:'dd MMMM yyyy, HH:mm' }}
            </p>
          </div>
        </div>
        <div class="header-right">
          <button class="btn-modern btn-refresh" (click)="refreshDashboard()" [disabled]="isLoading">
            <i class="bi bi-arrow-clockwise" [class.spinning]="isLoading"></i>
            {{ isLoading ? 'Chargement' : 'Actualiser' }}
          </button>
          <button class="btn-modern btn-stats" routerLink="/statistics">
            <i class="bi bi-graph-up"></i>
            Statistiques
          </button>
        </div>
      </div>
    </header>

    <!-- ========================================
         STATS CARDS (4 CARTES SIMPLES)
         ======================================== -->
    <section class="stats-section-modern">
      <div class="stats-grid-modern">

        <!-- Card 1: Users -->
        <div class="stat-card-modern stat-gradient-blue">
          <div class="stat-card-glass">
            <div class="stat-header-modern">
              <div class="stat-icon-modern">
                <i class="bi bi-people-fill"></i>
              </div>
              <div class="stat-trend" *ngIf="stats.pendingUsers > 0">
                <span class="trend-badge trend-warning">
                  <i class="bi bi-exclamation-circle"></i>
                  {{ stats.pendingUsers }}
                </span>
              </div>
            </div>
            <div class="stat-body-modern">
              <div class="stat-number">{{ stats.totalUsers }}</div>
              <div class="stat-label">Utilisateurs</div>
              <div class="stat-details-modern">
                <span class="detail-chip">
                  <i class="bi bi-check-circle-fill"></i>
                  {{ stats.approvedUsers }} approuvés
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 2: Projects -->
        <div class="stat-card-modern stat-gradient-purple">
          <div class="stat-card-glass">
            <div class="stat-header-modern">
              <div class="stat-icon-modern">
                <i class="bi bi-kanban-fill"></i>
              </div>
            </div>
            <div class="stat-body-modern">
              <div class="stat-number">{{ stats.totalProjects }}</div>
              <div class="stat-label">Projets actifs</div>
              <div class="stat-details-modern">
                <span class="detail-chip">
                  <i class="bi bi-graph-up"></i>
                  {{ stats.activeProjects }} en cours
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 3: Tasks -->
        <div class="stat-card-modern stat-gradient-green">
          <div class="stat-card-glass">
            <div class="stat-header-modern">
              <div class="stat-icon-modern">
                <i class="bi bi-check2-square"></i>
              </div>
              <div class="stat-trend">
                <span class="trend-badge trend-info">
                  {{ stats.completionRate }}%
                </span>
              </div>
            </div>
            <div class="stat-body-modern">
              <div class="stat-number">{{ stats.totalTasks }}</div>
              <div class="stat-label">Tâches</div>
              <div class="stat-details-modern">
                <span class="detail-chip chip-success">
                  {{ stats.completedTasks }} terminées
                </span>
                <span class="detail-chip chip-danger" *ngIf="stats.overdueTasks > 0">
                  {{ stats.overdueTasks }} en retard
                </span>
              </div>
            </div>
          </div>
        </div>

        <!-- Card 4: Meetings -->
        <div class="stat-card-modern stat-gradient-orange">
          <div class="stat-card-glass">
            <div class="stat-header-modern">
              <div class="stat-icon-modern">
                <i class="bi bi-calendar-event-fill"></i>
              </div>
              <div class="stat-trend" *ngIf="stats.todayMeetings > 0">
                <span class="trend-badge trend-warning">
                  <i class="bi bi-clock-fill"></i>
                  {{ stats.todayMeetings }}
                </span>
              </div>
            </div>
            <div class="stat-body-modern">
              <div class="stat-number">{{ stats.upcomingMeetings }}</div>
              <div class="stat-label">Réunions à venir</div>
              <div class="stat-details-modern">
                <span class="detail-chip">
                  <i class="bi bi-calendar-check"></i>
                  Cette semaine
                </span>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- ========================================
         ACTIONS RAPIDES
         ======================================== -->
    <section class="quick-actions-section">
      <div class="section-header-modern">
        <h2>
          <i class="bi bi-lightning-charge-fill"></i>
          Actions Rapides
        </h2>
      </div>
      <div class="quick-actions-grid">
        <div class="action-card-modern" *ngFor="let action of quickActions" (click)="navigateTo(action.route)">
          <div class="action-glass">
            <div class="action-icon-wrapper" [style.background]="action.color + '20'" [style.color]="action.color">
              <i class="bi" [ngClass]="action.icon"></i>
            </div>
            <div class="action-content">
              <h3>{{ action.title }}</h3>
              <p>{{ action.description }}</p>
            </div>
            <div class="action-arrow">
              <i class="bi bi-arrow-right-circle-fill"></i>
            </div>
            <div class="action-count" *ngIf="action.count !== undefined && action.count > 0">
              <span class="count-badge">{{ action.count }}</span>
            </div>
          </div>
        </div>
      </div>
    </section>

   <!-- ========================================
         UTILISATEURS EN ATTENTE (SECTION CORRIGÉE)
         ======================================== -->
    <section class="pending-section-modern" *ngIf="pendingUsers.length > 0">
      <div class="alert-card-modern-large">
        <div class="alert-glass-large">
          <div class="alert-header-large">
            <div class="alert-icon-wrapper-large">
              <i class="bi bi-bell-fill"></i>
            </div>
            <div class="alert-title-large">
              <h2>Utilisateurs en attente d'approbation</h2>
              <span class="alert-count-large">{{ pendingUsers.length }} utilisateur(s) en attente</span>
            </div>
          </div>

          <div class="pending-grid-modern">
            <div class="pending-item-modern" *ngFor="let user of pendingUsers">
              <div class="pending-avatar-modern">
                <i class="bi bi-person-circle"></i>
              </div>
              <div class="pending-info-modern">
                <h3>{{ user.username }}</h3>
                <div class="user-meta">
                  <span class="role-tag" [class]="'role-' + user.role.toLowerCase()">
                    <i class="bi bi-shield-fill-check"></i>
                    {{ user.role }}
                  </span>
                  <!-- ✅ SUPPRIMÉ: getDaysAgo(user.createdAt) -->
                  <span class="date-tag">
                    <i class="bi bi-clock"></i>
                    En attente d'approbation
                  </span>
                </div>
              </div>
              <div class="pending-actions-modern">
                <button class="btn-icon-modern btn-success-modern" 
                        (click)="approveUser(user.id); $event.stopPropagation()"
                        title="Approuver">
                  <i class="bi bi-check-lg"></i>
                  <span>Approuver</span>
                </button>
                <button class="btn-icon-modern btn-danger-modern" 
                        (click)="rejectUser(user.id); $event.stopPropagation()"
                        title="Rejeter">
                  <i class="bi bi-x-lg"></i>
                  <span>Rejeter</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ========================================
         FIL D'ACTIVITÉ & TÂCHES RÉCENTES
         ======================================== -->
    <section class="feed-section-modern">
      <div class="feed-grid-modern">

        <!-- Activity Feed -->
        <div class="feed-card-modern">
          <div class="feed-glass">
            <div class="feed-header-modern">
              <h3>
                <i class="bi bi-activity"></i>
                Fil d'activité
              </h3>
              <span class="time-chip">Dernières 24h</span>
            </div>
            <div class="activity-timeline-modern">
              <div class="timeline-item-modern" *ngFor="let activity of recentActivities">
                <div class="timeline-marker" [ngClass]="getActivityColor(activity.type)"></div>
                <div class="timeline-content">
                  <div class="timeline-header">
                    <h4>{{ activity.title }}</h4>
                    <span class="timeline-time">{{ formatDate(activity.date) }}</span>
                  </div>
                  <p>{{ activity.description }}</p>
                  <div class="timeline-footer">
                    <span class="timeline-user">
                      <i class="bi bi-person"></i>
                      {{ activity.userName }}
                    </span>
                    <span *ngIf="activity.status"
                          class="timeline-status"
                          [ngClass]="'status-' + getStatusColor(activity.status)">
                      {{ activity.status }}
                    </span>
                  </div>
                </div>
              </div>
              <div *ngIf="recentActivities.length === 0" class="empty-state-modern">
                <i class="bi bi-inbox"></i>
                <p>Aucune activité récente</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Recent Tasks -->
        <div class="tasks-card-modern">
          <div class="tasks-glass">
            <div class="tasks-header-modern">
              <h3>
                <i class="bi bi-list-check"></i>
                Tâches récentes
              </h3>
              <button class="btn-link-modern" routerLink="/mes-taches">
                Voir tout
                <i class="bi bi-arrow-right"></i>
              </button>
            </div>
            <div class="tasks-list-modern">
              <div class="task-item-modern" *ngFor="let task of recentTasks">
                <div class="task-check">
                  <div class="checkbox-modern" [class.checked]="task.isCompleted">
                    <i class="bi" [ngClass]="task.isCompleted ? 'bi-check-lg' : ''"></i>
                  </div>
                </div>
                <div class="task-content-modern">
                  <h4 [class.completed]="task.isCompleted">{{ task.title }}</h4>
                  <div class="task-meta-modern">
                    <span *ngIf="task.assignedUserName" class="meta-chip">
                      <i class="bi bi-person"></i>
                      {{ task.assignedUserName }}
                    </span>
                    <span class="meta-chip meta-date"
                          [ngClass]="{
                            'meta-danger': getStatus(task) === 'En retard',
                            'meta-warning': getStatus(task) === 'En cours'
                          }">
                      <i class="bi bi-calendar"></i>
                      {{ task.dueDate | date:'dd/MM' }}
                    </span>
                  </div>
                </div>
                <div class="task-status-modern">
                  <span class="status-indicator"
                        [ngClass]="'indicator-' + getStatusColor(getStatus(task))">
                  </span>
                </div>
              </div>
              <div *ngIf="recentTasks.length === 0" class="empty-state-modern">
                <i class="bi bi-inbox"></i>
                <p>Aucune tâche récente</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading-modern">
    <div class="loading-content">
      <div class="loading-spinner-modern"></div>
      <p>Chargement des données...</p>
    </div>
  </div>

</div>